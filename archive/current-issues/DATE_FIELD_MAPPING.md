# 📅 日付フィールドマッピング仕様書

## 概要
このドキュメントは、各エンティティの日付フィールドとその処理方法をまとめたものです。

## エンティティ別日付フィールド一覧

### 1. Tasks (タスク)
- **フィールド名**: `dueDate` (String?)
- **用途**: タスクの期限日
- **AIからの抽出フィールド**: `deadline`, `datetime`, `date`
- **特記事項**: 
  - 日付が設定されるとステータスが自動的に `DO` になる
  - 日付がない場合はステータスは `IDEA` のまま

### 2. Personal Schedules (個人予定)
- **フィールド名**: 
  - `date` (String) - 日付
  - `time` (String) - 開始時刻
  - `endTime` (String?) - 終了時刻
- **AIからの抽出フィールド**: `datetime`, `date`
- **特記事項**: 日付と時刻は分離して保存

### 3. Calendar Events (カレンダーイベント)
- **フィールド名**: 
  - `date` (String) - 日付
  - `time` (String) - 開始時刻
  - `endTime` (String?) - 終了時刻
- **AIからの抽出フィールド**: `datetime`, `date`
- **特記事項**: パブリックな共有イベント用

### 4. Appointments (アポイントメント)
- **フィールド名**: `lastContact` (String?)
- **用途**: 最終連絡日
- **AIからの抽出フィールド**: なし（現在未実装）
- **特記事項**: 営業活動の追跡用

### 5. Projects (プロジェクト)
- **フィールド名**: 
  - `startDate` (String) - 開始日
  - `endDate` (String?) - 終了日
- **AIからの抽出フィールド**: `startDate`, `endDate`
- **特記事項**: プロジェクト期間管理用

### 6. Connections (人脈)
- **フィールド名**: `date` (String)
- **用途**: 出会った日付
- **AIからの抽出フィールド**: `date`
- **特記事項**: 人脈管理用

### 7. Knowledge Items (ナレッジ)
- **フィールド名**: なし
- **特記事項**: タイムスタンプは `createdAt`, `updatedAt` で管理

## 日付フォーマット

### 保存形式
- **日付**: `YYYY-MM-DD` 形式（例: 2024-06-28）
- **時刻**: `HH:mm` 形式（例: 14:30）

### サポートされる入力形式
- `6/28` → 現在年または翌年の6月28日
- `6月28日` → 現在年または翌年の6月28日
- `明日` → 翌日の日付
- `今日 14時` → 本日14:00
- `明日 14:30` → 翌日14:30
- `来週火曜日` → 次の火曜日

## 実装状況

### ✅ 完了済み
1. **タスクの日付保存**: `dueDate`フィールドに正しく保存
2. **タスクステータス自動設定**: 日付があれば`DO`、なければ`IDEA`
3. **日付パース処理**: `datetime-parser.ts`で各種形式に対応
4. **更新時のステータス変更**: 日付が追加された際の自動ステータス更新

### ⚠️ 注意事項
1. すべての日付フィールドは文字列型（String）で保存
2. タイムゾーンはJST（日本標準時）基準
3. 過去の日付が入力された場合は翌年として解釈

## デバッグ情報

日付処理のデバッグには以下のログを確認：
```
📅 Date fields in extractedData: { ... }
📅 タスク期限解析成功: "6/28" → 2024-06-28
📊 タスクステータス決定: DO (dueDate: 2024-06-28)
```

## 今後の改善案
1. Appointmentsへの次回連絡予定日の追加
2. 繰り返し予定の対応強化
3. タイムゾーン設定の柔軟化