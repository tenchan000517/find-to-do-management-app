# 🚨 システム課題・改善要望一覧

**作成日**: 2025-06-17 23:15  
**優先度**: 高 🔴 / 中 🟡 / 低 🟢  
**ステータス**: 🔍調査中 / 📋計画中 / 🔧実装中 / ✅完了  

---

## 🔴 **高優先度ISSUE**

<!-- ### **1. カレンダー日付UTC問題** 🔴
**問題**: カレンダーの日付がUTCで表示されているが、登録等はJSTになっている  
**影響**: ユーザーの混乱・時差による表示ずれ  
**対応**: 
- カレンダー表示をJSTに統一
- datetime-jst.tsユーティリティの全面適用
- タイムゾーン処理の統一化

**ファイル**: `/src/components/calendar/*`、`/src/lib/utils/datetime-jst.ts`

--- -->

### ~~**2. LINE Webhook/Notification冗長性**~~ ✅ **完了**
~~**問題**: WebhookとNotificationが冗長的になっており、コードの複雑化とメンテナンス性悪化~~  
~~**影響**: 開発効率低下・バグリスク増加~~  
**対応完了**:
- ✅ WebhookとNotificationの責務分離（Phase 2完了）
- ✅ 共通処理の抽象化（5つのモジュールに分離）
- ✅ モジュール化によるリファクタリング（96%コード削減達成）

**完了日**: 2025-06-19

---

<!-- ### **3. LINEボタンタイムアウト問題** 🔴
**問題**: LINE登録のUIボタンが時間が経った後でも押せてしまう  
**影響**: 重複登録・セッション混乱・データ不整合  
**対応**:
- セッションタイムアウト実装
- ボタン無効化機能
- Redisセッション管理移行

**ファイル**: `/src/lib/line/session-manager.ts` -->

---

## 🟡 **中優先度ISSUE**

### **4. ナレッジ登録リンク除外問題** 🟡
**問題**: ナレッジ登録でリンクが除外されている（要約処理で削除？）  
**影響**: 重要な参考リンクの損失  
**対応**:
- リンク検知アルゴリズム改善
- UIコンポーネントでのリンクボタン化
- 要約処理でのリンク保持

**ファイル**: `/src/app/knowledge/page.tsx`、AI要約処理

---

### **5. カレンダー連携データ表示欠如** 🟡
<!-- **問題**: カレンダーにタスク、アポイントメント、プロジェクトが表示されていない  
**影響**: 統合スケジュール管理の機能不全   -->
**対応**:
- 統合カレンダーAPI修正
- タスク期限・アポ日程の自動反映
- プロジェクトマイルストーンの表示

**ファイル**: `/src/app/api/calendar/unified/route.ts`

---

### **6. LINE重複登録問題** 🟡
**問題**: ナレッジが重複登録されている（保存ボタン重複押下・メッセージ重複送信）  
**影響**: データ汚染・ストレージ無駄遣い  
**調査対象**:
- 保存ボタンの重複押下パターン
- シンプルな重複登録
- メッセージ重複送信
- ログ・データベース分析が必要

**ファイル**: LINE統合全般、データベースログ

---

### **7. LINEタスク登録難易度スコア日本語化** 🟡
**問題**: difficultyScoreがそのまま数値表示され、日本語化できていない  
**影響**: ユーザビリティ低下  
**発展案**: アルゴリズムの見直しと活用拡大
- 既存アルゴリズムの確認・検証
- 日本語ラベル化
- スコア活用の拡張

**ファイル**: `/src/lib/line/*`、難易度計算アルゴリズム

---

## 🟡 **中優先度ISSUE（続き）**

<!-- ### **8. 編集ボタン・モーダル機能不全** 🔴 **NEW**
**問題**: 全エンティティ（タスク・プロジェクト・アポ・コネクション・ナレッジ等）の編集機能に問題
**影響**: データ更新ができない、ユーザビリティ大幅低下
**具体的症状**:
- 編集ボタンが押せない（クリック無反応）
- 編集モーダルが開かない
- 編集内容が保存されない
- 型エラーによる機能停止

**推定原因**: 担当者システム移行時の型定義不整合、モーダル状態管理の問題
**対応**: 全エンティティの編集機能を順次修復・テスト -->

---

### **9. アポイントメント日程管理フロー改善** 🟡 **NEW**
**問題**: アポイントメントに直接日付フィールドがなく、calendar_eventsとの紐付けが必須だが、実際には紐付けられていない
**影響**: カレンダーにアポイントメントが表示されない、日程管理が煩雑
**要件案**:
- カンバンで「待機」→「進行中」移動時に実施日入力を促す（アラート/トースト）
- 「完了」移動時に次回アポの有無を確認
  - 次回なし → 待機リストor削除を選択
  - 次回あり → 日付設定して「進行中」へ自動移動
- 裏側でコネクションステータスを自動更新（初回接触→関係構築中など）

**技術要件**: カンバンドラッグ&ドロップイベント拡張、モーダル/トースト実装、ステータス連動処理

---

### **10. EventEditModal アポイントメントAPI統合** 🟡 **NEW**
**問題**: EventEditModalでアポイントメント編集時に適切なAPIエンドポイントが使用されていない
**詳細**: 現在はcalendar_eventsのAPIを使用しているが、/api/appointments/[id] の専用エンドポイントが存在する
**影響**: アポイントメントデータの更新が適切に反映されない可能性
**対応**: 
- EventEditModalのgetApiConfig関数でアポイントメント編集時に/api/appointments/[id]を使用
- アポイントメント固有のフィールド（companyName, contactName等）の編集サポート

**ファイル**: `/src/components/calendar/EventEditModal.tsx`, `/src/app/api/appointments/[id]/route.ts`

---

## 🟢 **低優先度・発展的ISSUE**

### **9. プロジェクトチーム分析・レコメンデーション** 🟢
**機能拡張**: プロジェクトのチームメンバー選択時の高度分析  
**実装内容**:
- チームメンバーの特性・適性・MBTI・スキル分析
- プロジェクト成功率自動算出
- 不足能力・役割の自動レコメンド
- チーム編成最適化提案

**技術要件**: AI分析エンジン拡張、MBTI分析、スキルマッチング

---

### **10. パーソナライズドリソース管理** 🟢
**機能拡張**: 個人別リソースキャパシティ管理システム  
**実装内容**:
- ユーザー別リソースキャパシティ設定
- タスク・予定のリソース計算
- オーバーワーク・余裕度のサマリー表示
- 得意不得意によるパーソナライズド見積もり
- リソース配分最適化提案

**技術要件**: リソース計算エンジン、個人特性分析、予測アルゴリズム

---

### **11. プロジェクト統合管理システム** 🟢
**機能拡張**: プロジェクト中心の統合管理機能  
**実装内容**:
- タスク・アポとプロジェクトの自動紐づけ
- 進捗率への自動反映
- プロジェクトアクティブ率計算
- ガントチャート自動マイルストーン化
- 作成時の親子関係設定
- 既存エンティティとの紐づけ機能

**技術要件**: プロジェクト関係性エンジン、ガントチャート拡張、進捗計算

---

### **12. LINE既存データ編集機能** 🟢
**機能拡張**: LINEから既存の予定・アポ・タスクの編集機能  
**実装内容**:
- 既存データ検索・選択
- 編集項目選択
- 更新処理
- 変更履歴管理

**技術要件**: 検索機能、編集UI、差分管理

---

### **13. タスク難易度スコア精度向上・活用拡大** 🟢
**機能拡張**: difficultyScoreアルゴリズムの精度向上と活用範囲拡大  
**実装内容**:
- AIベースの難易度分析精度向上
- ユーザー実績データによる学習機能
- 難易度に基づく自動優先度調整
- チームメンバーとの難易度差分析
- プロジェクト全体の難易度バランス最適化

**技術要件**: ML学習機能、実績データ蓄積、パーソナライゼーション
**補足**: 現在は基本的な数値計算のみ。AI分析・個人適性・実績反映で精度向上可能

---

### ✅ **14. 人脈管理機能強化** 🟢 **完了済み**
**機能拡張**: 人脈管理システムの連絡先情報・フィルタリング機能拡張  
**実装完了内容**:
- ✅ connectionsテーブルにemail・phoneフィールド追加
- ✅ 人脈作成・編集フォームの連絡先情報入力機能
- ✅ 企業別フィルタリング機能実装
- ✅ 検索機能拡張（メール・電話番号対応）
- ✅ テーブル・カード表示への連絡先情報統合

**技術実装**: Prismaスキーマ更新、型定義更新、UI/UX統合
**完了日**: 2025-06-19

### **15. 全エンティティリンク検出・管理システム** 🟢
**機能拡張**: ナレッジ含む全エンティティでリンク自動検出・分類・適切表示  
**実装内容**:
- テキストフィールドからのURL自動検出・構造化保存
- ミーティングURL・情報URL・一般URLの分類システム
- エンティティタイプ別の適切なUI表示（ボタン化等）
- entity_linksテーブル新設によるリンク情報管理

**技術要件**: 正規表現URL抽出、データベース拡張、ButtonUIコンポーネント
**補足**: 大規模機能のため段階的実装推奨。アクティブ開発課題で詳細仕様管理中

---

### **16. DiscordボットCOMPASS API連携・イベント取得** 🟡 **NEW**
**機能拡張**: Discordボットの外部API連携強化とイベント管理
**実装内容**:
- COMPASS API連携によるイベント情報自動取得
- Discordチャンネルへのイベント通知自動化
- イベント参加者管理・リマインダー機能
- APIレスポンスのキャッシュ・エラーハンドリング

**技術要件**: COMPASS API統合、Discord.js拡張、スケジューラー実装
**補足**: 外部APIの仕様確認とレート制限対策が必要

---

### **17. KPIボット調整・Discordインサイト計算拡張** 🟡 **NEW**
**機能拡張**: Discord活動分析の高度化とKPI管理
**実装内容**:
- KPIボット側の計算ロジック調整・最適化
- Discordインサイト計算アルゴリズムの拡張
- 必要データの追加取得（メッセージ反応、スレッド活動、VC参加時間等）
- 分析ダッシュボードのデータ項目拡張
- カスタムメトリクスの定義・実装

**技術要件**: Discord API拡張活用、データ分析アルゴリズム、可視化改善
**補足**: プライバシー配慮とパフォーマンス最適化が重要

---

## 🔬 **調査・研究課題**

### **13. 統合テスト実施** 🔍
**目的**: システム全体の品質保証  
**対象**:
- 全機能の動作確認
- データ整合性テスト
- パフォーマンステスト
- セキュリティテスト
- ユーザビリティテスト

**実施方法**: 自動テスト + 手動テスト + ロードテスト

---

### **14. 未活用アルゴリズム・機能の発掘** 🔍
**目的**: 既存システムの潜在能力最大化  
**調査対象**:
- AI評価エンジンの未活用機能
- 関係性分析システムの拡張可能性
- アラートシステムの高度化
- プロジェクト昇華システムの改良

**調査方法**: コードベース分析、ドキュメント調査、機能マッピング

---

### **15. ドキュメント機能ギャップ分析** 🔍
**目的**: 設計されているが実装されていない機能の特定  
**調査対象**:
- 要件定義書との比較
- アーキテクチャ設計との乖離
- 未実装API・機能の特定
- 技術的負債の洗い出し

**成果物**: 機能ギャップレポート、実装優先度付けリスト

---

## 📋 **ISSUE管理マトリックス**

| ISSUE | 優先度 | 影響度 | 実装難易度 | 推定工数 | 担当候補 |
|-------|--------|--------|------------|----------|----------|
| カレンダーUTC問題 | 🔴 | 高 | 中 | 1-2日 | フロントエンド |
| ~~LINE冗長性~~ | ~~🔴~~ | ~~高~~ | ~~高~~ | ~~3-5日~~ | ~~バックエンド~~ **完了** |
| LINEタイムアウト | 🔴 | 高 | 中 | 2-3日 | バックエンド |
| 編集ボタン機能不全 | 🔴 | 高 | 中 | 3-5日 | フロントエンド |
| ナレッジリンク | 🟡 | 中 | 中 | 1-2日 | フルスタック |
| カレンダー連携 | 🟡 | 中 | 中 | 2-3日 | フルスタック |
| LINE重複問題 | 🟡 | 中 | 高 | 3-4日 | データ分析+バックエンド |
| ~~難易度スコア~~ | ~~🟡~~ | ~~低~~ | ~~低~~ | ~~0.5-1日~~ | ~~フロントエンド~~ **完了** |
| アポ日程管理 | 🟡 | 中 | 中 | 2-3日 | フルスタック |
| チーム分析 | 🟢 | 高 | 高 | 1-2週 | AI+フルスタック |
| リソース管理 | 🟢 | 高 | 高 | 1-2週 | アルゴリズム+フルスタック |
| プロジェクト統合 | 🟢 | 高 | 高 | 2-3週 | フルスタック |

---

## 🚀 **実装提案ロードマップ**

### **Phase A: 緊急修正（1-2週間）**
1. カレンダーUTC問題修正
2. LINEボタンタイムアウト実装
3. ナレッジリンク表示修正

### **Phase B: 品質向上（2-3週間）**
1. LINE冗長性リファクタリング
2. カレンダー連携データ表示
3. アポイントメント日程管理フロー実装
4. 統合テスト実施
5. LINE重複問題調査・修正

### **Phase C: 機能拡張（1-2ヶ月）**
1. プロジェクト統合管理システム
2. パーソナライズドリソース管理
3. チーム分析・レコメンデーション
4. 未活用機能の発掘・活用

---

## 📞 **緊急度判定基準**

**🔴 緊急**: ユーザー体験に直接影響・データ整合性に問題  
**🟡 重要**: 機能の完全性・開発効率に影響  
**🟢 改善**: システム価値向上・将来の拡張性  

---

**次回更新**: 課題対応進捗に応じて随時更新  
**管理方針**: 高優先度から順次対応、定期的な見直し実施

---

*作成者: Claude Code*  
*最終更新: 2025-06-17 23:15*