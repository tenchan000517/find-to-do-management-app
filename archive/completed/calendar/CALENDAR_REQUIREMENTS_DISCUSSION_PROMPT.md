# 【カレンダー機能要件定義プロンプト】タスク管理システム統合カレンダー

**作成日**: 2025-06-15
**対象**: カレンダー機能の要件定義・設計・実装を担当するエンジニア

---

## 🎯 あなたの役割

あなたは**既存のタスク管理システムにカレンダー機能を統合する**要件定義・設計・実装を担当するエンジニアです。

既存システムの機能を十分に理解し、ユーザーにとって最適なカレンダー体験を設計・実装してください。

---

## 📊 現在のシステム状況（完全把握必須）

### ✅ **Phase 1-8 + LINEボット機能完全実装済み**

**既存の核心機能:**
- **タスク管理**: PDCA サイクル、ユーザー・プロジェクト・ステータス別管理
- **プロジェクト管理**: 4種類カンバンUI、AI評価エンジン、昇華システム
- **アポ管理**: 4種類カンバンUI、営業活動管理、AI重要度計算
- **人脈管理**: connections テーブル、関係性分析
- **AI統合**: 成功確率・リソースウェイト・ISSUE度自動評価
- **LINEボット**: 自然言語入力→AI分析→分類確認→DB保存の完全フロー

### 📋 **既存のカレンダー関連データ**

#### **calendar_events テーブル（既存）**
```sql
CREATE TABLE calendar_events (
  id           String     @id
  title        String     -- イベントタイトル
  date         String     -- YYYY-MM-DD形式
  time         String     -- HH:mm形式
  type         event_type @default(MEETING) -- MEETING/EVENT/DEADLINE
  description  String     @default("")
  participants String[]   @default([])
  location     String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
)

enum event_type {
  MEETING
  EVENT  
  DEADLINE
}
```

#### **関連する既存データ**
- **tasks**: `dueDate` フィールド（期限管理）
- **appointments**: 営業アポイントメント管理
- **users**: 6名の実ユーザー（川島、弓木野、漆畑、池本、飯田等）
- **182件のリアルデータ**: プロジェクト、タスク、人脈、カレンダーイベント

### 🤖 **LINEボット統合状況**
- **自然言語入力**: "明日14時に会議" → AI分析 → calendar_events自動作成
- **ハイブリッド日時解析**: パターンマッチング + AI解析で高精度日時変換
- **ユーザーマッピング**: LINE UserID → System UserID自動変換
- **実稼働確認済み**: 実際のテストでDB保存成功

### 🛠 **技術スタック**
- **フロントエンド**: Next.js 15 + TypeScript + Tailwind CSS
- **バックエンド**: Next.js App Router + Prisma ORM
- **データベース**: PostgreSQL
- **AI**: Gemini API（Call Manager でレート制限・キャッシング実装済み）

---

## 🎯 カレンダー機能の検討ポイント

### 💭 **基本方針の検討**

#### **1. カレンダーUIの方向性**
**検討項目:**
- **月表示 vs 週表示 vs 日表示** - どの粒度をメインにするか？
- **既存UI との統合度** - 新規ページ vs 既存ページ内埋め込み
- **レスポンシブ対応** - モバイルでの操作性をどう確保するか？

**参考情報:**
- 既存システムは4種類のカンバンUIを持つ
- ユーザーは営業活動中心（アポ・人脈管理が重要）
- LINEボットからの入力頻度が高い

#### **2. データ統合の戦略**
**検討項目:**
- **tasks.dueDate との関係** - タスク期限をカレンダーに表示するか？
- **appointments との統合** - 営業アポをカレンダーで管理するか？
- **リマインド機能** - LINE通知との連携をどう設計するか？

**既存データ活用:**
- `calendar_events`: 182件中の一部がカレンダーイベント
- `appointments`: 営業アポデータ（重要度AI評価済み）
- `tasks`: PDCAサイクル管理（期限設定可能）

#### **3. 機能優先度の検討**
**検討項目:**
- **表示機能** - 既存データの可視化（最重要）
- **作成・編集機能** - UI経由でのイベント作成
- **統合機能** - タスク・アポとの連携表示
- **通知機能** - LINEボット連携リマインド

### 🔍 **具体的な要件定義項目**

#### **A. 表示機能要件**
1. **カレンダービュー**
   - 月/週/日表示の選択肢
   - イベントタイプ別の色分け表示
   - 時間帯表示（終日 vs 時刻指定）

2. **統合表示**
   - calendar_events の表示
   - tasks.dueDate の期限表示
   - appointments の営業アポ表示
   - 表示ON/OFF切り替え

3. **詳細表示**
   - イベントクリック時の詳細ポップアップ
   - 参加者・場所・説明の表示
   - 関連タスク・プロジェクトへのリンク

#### **B. 操作機能要件**
1. **イベント作成**
   - カレンダーUI上でのドラッグ&ドロップ作成
   - 既存のLINEボット入力との併用
   - フォーム入力での詳細設定

2. **編集・削除**
   - 既存イベントの編集機能
   - 削除時の確認・関連データ処理
   - 繰り返しイベント対応の要否

3. **ナビゲーション**
   - 年月移動の操作性
   - 今日への素早い移動
   - 検索・フィルタ機能

#### **C. 統合機能要件**
1. **タスク連携**
   - タスク期限のカレンダー表示
   - カレンダーからタスク詳細へのアクセス
   - 期限変更時の同期処理

2. **アポ連携**
   - 営業アポの表示・管理
   - 重要度による表示優先度
   - アポ完了→人脈データ連携

3. **プロジェクト連携**
   - プロジェクト期限・マイルストーンの表示
   - プロジェクトフェーズとカレンダーの連動

#### **D. LINE連携要件**
1. **入力連携**
   - 既存のLINEボット入力フローとの整合性
   - ハイブリッド日時解析の活用
   - セッション管理との連携

2. **通知連携**
   - カレンダーイベントのLINE通知
   - リマインド機能（事前通知）
   - 変更・キャンセル通知

---

## 💡 検討のためのディスカッション観点

### 🤔 **ユーザー体験の検討**

#### **1. 主要ユーザーのペルソナ理解**
- **川島さん（リーダー）**: プロジェクト全体管理、チーム調整
- **営業メンバー**: アポ管理、人脈管理中心
- **開発メンバー**: タスク期限管理、プロジェクト進捗確認

#### **2. 利用シーン分析**
- **朝の予定確認**: 今日のアポ・会議・タスク期限の一覧確認
- **アポ調整**: 営業活動での空き時間確認・アポ設定
- **プロジェクト管理**: マイルストーン・期限の可視化
- **チーム共有**: メンバーの予定・稼働状況確認

#### **3. 既存フローとの整合性**
- **LINEボット入力**: "明日14時に○○会議" → カレンダー反映
- **アポ管理**: カンバンでのアポ管理 ↔ カレンダー表示
- **タスク期限**: PDCA管理での期限 ↔ カレンダー期限表示

### 🔧 **技術実装の検討**

#### **1. フロントエンド設計**
- **カレンダーライブラリ**: react-calendar vs FullCalendar vs 自作
- **状態管理**: 既存のクライアント状態管理との統合
- **パフォーマンス**: 大量データ表示時の最適化

#### **2. バックエンド設計**
- **API設計**: RESTful vs GraphQL（既存APIとの整合性）
- **データ取得**: 月次・週次での効率的なクエリ設計
- **リアルタイム更新**: 複数ユーザー間での同期方法

#### **3. データベース設計**
- **calendar_events拡張**: 既存テーブルの活用 vs 新規設計
- **関連テーブル設計**: tasks, appointments との多対多関係
- **パフォーマンス**: インデックス設計・クエリ最適化

---

## 📝 要件定義の進め方

### 🎯 **Phase 1: 要件ディスカッション**
1. **ユーザーニーズ分析**: 主要な利用シーンと優先度の決定
2. **機能スコープ決定**: MVP（最小機能）→ 段階的拡張の計画
3. **技術選択肢検討**: ライブラリ・アーキテクチャの選定
4. **既存システム影響分析**: 変更範囲・リスクの評価

### 🎯 **Phase 2: 設計・プロトタイプ**
1. **UI/UX設計**: ワイヤーフレーム・画面遷移設計
2. **API設計**: エンドポイント・データ形式の定義
3. **データベース設計**: スキーマ変更・マイグレーション計画
4. **技術PoC**: 選定技術での動作確認

### 🎯 **Phase 3: 実装・テスト**
1. **段階的実装**: MVP → 機能拡張の順次実装
2. **既存機能保護**: 既存システムへの影響ゼロを確保
3. **統合テスト**: LINEボット・他機能との連携確認
4. **ユーザーテスト**: 実際の利用シーンでの検証

---

## 🚀 ディスカッション開始のための質問例

### 💭 **要件確認のための質問**

1. **優先度の確認**
   - カレンダー機能で最も重要な価値は何ですか？（可視化 vs 入力効率 vs 通知）
   - 既存のアポ管理・タスク管理との使い分けをどう考えますか？

2. **利用シーン深掘り**
   - 最も頻繁に使われると想定される操作は何ですか？
   - モバイル（LINE）とPC（Web）での利用バランスはどの程度ですか？

3. **統合範囲の確認**
   - タスクの期限をカレンダーに表示する必要がありますか？
   - 営業アポとカレンダーイベントは同じ画面で管理したいですか？

4. **技術制約の確認**
   - 既存システムのレスポンス性能を維持する必要がありますか？
   - 新しいライブラリ導入に制約はありますか？

### 📊 **現状データ活用の確認**

1. **既存データの活用方針**
   - 現在の182件のリアルデータをどう活用しますか？
   - calendar_eventsの既存データに問題はありませんか？

2. **LINEボット連携の範囲**
   - 現在の"明日14時"入力フローは満足していますか？
   - カレンダーからの逆方向（通知）機能は必要ですか？

---

## 🛠 利用可能なリソース

### 📚 **参考ドキュメント**
- **[開発手法論](./docs/CLAUDE_CODE_DEVELOPMENT_METHODOLOGY.md)** - 開発制約・手法
- **[実装インデックス](./docs/MASTER_IMPLEMENTATION_INDEX.md)** - 全体アーキテクチャ
- **[データベース操作ナレッジ](./docs/DATABASE_OPERATIONS_KNOWLEDGE.md)** - DB操作のベストプラクティス

### 🧪 **既存システム確認コマンド**
```bash
# データ現状確認
node -e "const {PrismaClient} = require('@prisma/client'); const p = new PrismaClient(); Promise.all([p.calendar_events.count(), p.tasks.count({where: {dueDate: {not: null}}}), p.appointments.count()]).then(r => console.log('カレンダー関連データ:', {events: r[0], tasksWithDue: r[1], appointments: r[2]})).finally(() => p.\$disconnect())"

# UI現状確認（開発サーバー起動）
npm run dev  # http://localhost:3000 でアクセス

# 既存機能テスト
curl "http://localhost:3000/api/calendar" # 既存APIの確認
```

### 💡 **実装時の注意事項**
- **既存機能破壊厳禁**: Phase 1-8の機能に一切影響を与えない
- **段階的実装**: MVP → 拡張の安全な進め方
- **TypeScript必須**: 型安全性の維持
- **パフォーマンス重視**: 大量データでも2秒以内の応答

---

## 🎯 目標設定

### 🏆 **成功の定義**
1. **ユーザー価値**: 既存ワークフローが効率化される
2. **技術品質**: 既存システムの安定性を維持
3. **拡張性**: 将来的な機能追加に対応可能
4. **運用性**: メンテナンス・トラブル対応が容易

### 📈 **段階的ゴール**
- **MVP**: 基本的なカレンダー表示・既存データ統合
- **Phase 2**: イベント作成・編集機能
- **Phase 3**: 高度な統合機能・通知機能
- **Phase 4**: ユーザビリティ向上・パフォーマンス最適化

---

**🚀 さあ、カレンダー機能の要件定義を始めましょう！**

既存システムの機能を理解した上で、ユーザーにとって最適なカレンダー体験を一緒に設計していきます。