# BUG: カレンダーカードドラッグ問題

**作成日**: 2025年6月30日  
**分類**: Bug - UI/UX  
**影響範囲**: カレンダー機能 - ドラッグ&ドロップ  
**優先度**: High  

---

## 🚨 問題概要

カレンダーで一度移動したアイテムの移動先セルにおいて、カードがドラッグできずに日付クリック後のリストモーダルのみが表示される問題。

### **具体的な症状**
- 初回移動: 正常にドラッグ&ドロップ可能
- 移動後: 同じカードが再度ドラッグできない
- クリック動作: 日付モーダルが開くのみ
- イベント競合: ドラッグイベントと日付クリックイベントの競合

---

## 🔍 技術的分析

### **推定原因**
1. **イベントハンドラーの競合**
   - ドラッグイベントと日付クリックイベントが競合
   - イベントバブリングの制御不適切

2. **DOM要素の状態管理問題**
   - 移動後のDOM要素の属性変更
   - ドラッグ可能状態の管理不良

3. **React状態の同期問題**
   - 移動後のコンポーネント状態更新不良
   - re-renderingによるイベントハンドラー喪失

---

## 🔍 調査が必要な項目

### **技術的確認事項**
1. **イベントハンドラーの確認**
   - `onDragStart`, `onDragEnd`, `onClick`の実装
   - `event.preventDefault()`, `event.stopPropagation()`の適用

2. **DOM属性の確認**
   - `draggable` 属性の動的変更
   - カード移動後の属性値確認

3. **React状態管理の確認**
   - 移動後のコンポーネント状態更新
   - useEffectによるイベントハンドラー再登録

---

## 🎯 解決方針

### **Phase 1: 問題特定**
- [ ] カレンダーコンポーネントのイベントハンドラー調査
- [ ] ドラッグ&ドロップライブラリの実装確認
- [ ] DOM要素の動的属性変更確認

### **Phase 2: 修正実装**
- [ ] イベント競合の解決
- [ ] ドラッグ可能状態の適切な管理
- [ ] 移動後の状態同期修正

### **Phase 3: テスト・検証**
- [ ] 複数回移動の動作確認
- [ ] 異なるセル間での移動テスト
- [ ] モーダル表示との競合確認

---

**関連ファイル**: 
- `src/components/Calendar/CalendarCard.tsx`
- `src/components/Calendar/CalendarGrid.tsx`
- `src/hooks/useCalendarDrag.ts`

**ステータス**: 調査待ち  
**担当**: 未定  
**期限**: 未定